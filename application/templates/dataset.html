{% extends "layouts/layout.html" %}
{% from 'components/summary-card/macro.jinja' import appSummaryCard %}

{% block pageTitle %}{{ dataset["name"] }} Dataset | Digital Land{% endblock %}

{% block headStart %}
  <meta name="generated-date" content="{{ now }}"/>
{% endblock headStart %}

{%- block breadcrumbs -%}
  {{- govukBreadcrumbs({
    "items": [
        {
          "text": "Digital Land",
          "href": "/"
        },
        {
          "text": "Datasets",
          "href": "/dataset/"
        },
        {
          "text": dataset["name"]
        }
    ]
    }) -}}
{%- endblock -%}

{% block content %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <span class="govuk-caption-xl">Dataset</span>
      <h1 class="govuk-heading-xl">{{ dataset["name"] }}</h1>
    </div>
  </div>
  <!-- /.govuk-grid-row -->

  <div class="govuk-grid-row">

    <div class="govuk-grid-column-two-thirds">

      {% call appSummaryCard({ 'classes': 'govuk-!-margin-bottom-6' }) %}
        <dl class="govuk-summary-list govuk-!-margin-bottom-0">
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key govuk-!-width-one-half">Total</dt>
            <dd class="govuk-summary-list__value govuk-!-width-one-half">{{ entity_count|commanum }} <br><span class="govuk-!-font-size-14">{{ dataset["name"] if entity_count <= 1 else dataset["plural"] }}</span></dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key govuk-!-width-one-half">Publishers</dt>
            <dd class="govuk-summary-list__value govuk-!-width-one-half">{{ publishers['current'] }} of {{ publishers['expected'] }}</dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key govuk-!-width-one-half">Latest resource collected on</dt>
            <dd class="govuk-summary-list__value govuk-!-width-one-half">{{ latest_resource.last_updated if latest_resource.last_updated else 'N/A' }}</dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key govuk-!-width-one-half">Collector last ran on</dt>
            <dd class="govuk-summary-list__value govuk-!-width-one-half">{{ last_collection_attempt if last_collection_attempt else 'no attempt' }}</dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key govuk-!-width-one-half">Licence</dt>
            <dd class="govuk-summary-list__value govuk-!-width-one-half">{{ dataset.licence }}</dd>
          </div>
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__key govuk-!-width-one-half">Attribution</dt>
            <dd class="govuk-summary-list__value govuk-!-width-one-half">{{ dataset.attribution.replace('-', ' ').capitalize() }}</dd>
          </div>
        </dl>
      {% endcall %}

      {% if dataset.text %}
      <div class="app-prose">
        {{ dataset.text | render_markdown }}
      </div>
      {% endif %}


      {% if categories %}
        {% call appSummaryCard({ 'classes': 'govuk-!-margin-bottom-9' }) %}
          <table class="govuk-table">
            <caption class="govuk-table__caption govuk-table__caption--m">Categories</caption>
            <thead class="govuk-table__head">
              <tr class="govuk-table__row">
                <th scope="col" class="govuk-table__header">
                  Name
                </th>
                <th scope="col" class="govuk-table__header">
                  Entry Date
                </th>
              </tr>
            </thead>
            <tbody class="govuk-table__body">
              {% for category in categories %}
                <tr class="govuk-table__row">
                  <td class="govuk-table__cell app-table__cell">
                      <a class="govuk-link"  href="/curie/{{dataset['dataset']}}:{{category['reference']}}">{{category['name']}}</a>
                  </td>
                  <td class="govuk-table__cell app-table__cell">
                      {{category['entry-date']}}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endcall %}
      {% endif %}

    </div>
    <!-- / grid-column-two-thirds -->

    <div class="govuk-grid-column-one-third">

      <aside class="app-related-items" role="complementary">
        <h2 class="govuk-heading-s govuk-!-margin-bottom-0" id="view-the-data">
          View the data
        </h2>
        <p class="govuk-hint govuk-!-font-size-14">You can explore this data</p>
        <nav role="navigation" aria-labelledby="view-the-data">
          <ul class="govuk-list govuk-!-font-size-16">
            {% if dataset['typology'] == 'geography' %}
              <li>
                <a class="govuk-link" href='/map?dataset={{dataset["dataset"]}}'>On a map</a>
              </li>
            {% endif %}
            <li>
              <a class="govuk-link" href="/entity?dataset={{dataset["dataset"]}}">As a list</a>
            </li>
          </ul>
        </nav>
        <hr class="govuk-section-break govuk-section-break--m">
        <h2 class="govuk-heading-s govuk-!-margin-bottom-0" id="download-the-data">
          Download the data
        </h2>
        <p class="govuk-hint govuk-!-font-size-14">You can take a copy of this data as</p>
        <nav role="navigation" aria-labelledby="download-the-data">
          <ul class="govuk-list govuk-!-font-size-16">
            <li>
              <a class="govuk-link" href="{{ hoisted_bucket }}/{{ dataset["dataset"] }}-hoisted.csv">CSV</a>
            </li>
            <li>
              <a class="govuk-link" href="/entity.json?dataset={{ dataset['dataset'] }}">JSON</a>
            </li>
            {% if dataset['typology'] == 'geography' %}
            <li>
              <a class="govuk-link" href="/entity.geojson?dataset={{ dataset['dataset'] }}">GeoJSON</a>
            </li>
            {% endif %}
          </ul>
        </nav>
        <hr class="govuk-section-break govuk-section-break--m">
        <h2 class="govuk-heading-s govuk-!-margin-bottom-0" id="specification">
          Specification
        </h2>
        <p class="govuk-hint govuk-!-font-size-14">You can view the definition of the this dataset including the list of fields</p>
        <nav role="navigation" aria-labelledby="specification">
          <ul class="govuk-list govuk-!-font-size-16">
            <li>
              <a class="govuk-link" href="https://digital-land.github.io/specification/dataset/{{ dataset["dataset"] }}">Specification for {{ dataset["name"] }} dataset</a>
            </li>
          </ul>
        </nav>
      </aside>

    </div>
  </div>

  <div class="govuk-grid-row">

    <div class="govuk-grid-column-full">
      <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible">
      <h3 class="govuk-heading-s govuk-!-margin-bottom-2 govuk-!-margin-top-0">Help improve this data</h3>
      <p class="govuk-body">If you have found any issues with this dataset, please complete <a href="https://docs.google.com/forms/d/e/1FAIpQLSeOTmyAeKH5m0Xy3pXAYNcNApPdx0_Eioj-toHCOMZWiEdU8g/viewform?usp=sf_link" class="govuk-link">this form</a>, or email your questions and corrections to <a href="mailto:{{ templateVar.email }}" class="govuk-link">{{ templateVar.email }}</a>.</p>
    </div>
  </div>

{% endblock %}
